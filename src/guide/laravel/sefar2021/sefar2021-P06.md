# Proyecto App Sefar Universal 2021 (Parte VI)
+ Versión: **Laravel Framework 8.31.0**


## Pendientes:
1. Pendiente


## CRUD Clientes con Liveware
1. Pendiente


## CRUD Diex con Liveware
1. Pendiente


## CRUD Maisanta con Liveware
1. Crear vista Registro **resources\views\auth\registro.blade.php**
2. Crear controlador Registro: 
    + $ php artisan make:controller RegistroController
3. Crear ruta en routes\web.php


## Convertir la aplicación en PWA (Aplicación Web Progresiva)
1. Crear archivo de configuración del **Service Worker** en (public\sw.js):
    ```js
    const CACHE_ELEMENTS = [
        // Incluir todas las rutas que usa la aplicación, incluyendo los CDN's
        "./",
        "./agclientes",
        "./albero",
        "./books",
        "./consultaodx",
        "./countries",
        "./dashboard",
        "./families",
        "./files",
        "./formats",
        "./lados",
        "./libraries",
        "./login",
        "./logout",
        "./miscelaneos",
        "./olivo",
        "./parentescos",
        "./permissions",
        "./procesar",
        "./register",
        "./registro",
        "./roles",
        "./salir",
        "./t_files",
        "./tree",
        "./user/password",
        "./profile",
        "./users",
        "./css/app.css",
        "./css/sefar.css",
        "./js/app.js",
        "https://cdn.jsdelivr.net/npm/sweetalert2@9",
        "https://app.sefaruniversal.com/vendor/adminlte/dist/img/LogoSefar.png",
        "https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap",
        "http://www.w3.org/2000/svg",
        "https://laravel.com/docs",
        "https://laracasts.com",
        "https://laravel-news.com",
        "https://forge.laravel.com",
        "https://laravel.bigcartel.com",
        "https://github.com/sponsors/taylorotwell"
    ]

    const CACHE_NAME = "v1_cache_app_sefar_old"

    self.addEventListener("install", (e) => {
        e.waitUntil(
            caches.open(CACHE_NAME)
                .then(cache => {
                    cache.addAll(CACHE_ELEMENTS)
                        .then(() => {
                            self.skipWaiting()
                        }).catch(console.log)
                })
        )
    })

    self.addEventListener("activate", (e) => {
        const cacheWhiteList = [CACHE_NAME]

        e.waitUntil(
            caches.keys().then((cacheNames) => {
                return Promise.all(
                    cacheNames.map((cacheName) => {
                        return (
                            cacheWhiteList.indexOf(cacheName) === -1 && caches.delete(cacheName)
                        )
                    })
                )
            }).then(() => self.clients.claim())
        )
    })

    self.addEventListener("fetch", (e) => {
        e.respondWith(
            caches.match(e.request).then((res) => {
                if(res){
                    return res
                }
                return fetch(e.request)
            })
        )
    })
    ```
    ::: tip
    **Nota**: para establecer las propiedades de incon ir a [PWABuilder](https://www.pwabuilder.com/imageGenerator) e introducir como a imagen base la de **public\Logo.png**. En la página establecer:
        + Padding: 0
        + Background Color: Tranparent
        + Clic en **Generate** y descomprimir el zip generado en la raíz de **public**.
        + Luego eliminar los siguientes archivos:
            + public\AppImages.zip
            + public\icons.json
    Otra opción para generar las imagenes de la aplicación es ir a: https://www.npmjs.com/package/pwa-asset-generator
    :::
2. Crear archivo de registro del SW (public\register.js):
    ```js
    if(navigator.serviceWorker) {
        navigator.serviceWorker.register("./sw.js")
    }
    ```
3. Crear archivo de manifiesto **public\manifest.json**:
    ```json
    {
        "name": "Aplicación Sefar Universal",
        "short_name": "App Sefar",
        "description": "Abogados y genealogistas expertos en inmigración. Conseguimos tu pasaporte español, portugues e italiano, para que seas libre, trascendiendo fronteras.",
        "background_color": "#333333",
        "theme_color": "#333333",
        "start_url": "./",
        "scope": "./",
        "lang": "es",
        "display": "standalone",
        "orientation": "portrait",
        "icons": [
            {
                "src": "windows11/SmallTile.scale-100.png",
                "sizes": "71x71"
            },
            {
                "src": "windows11/SmallTile.scale-125.png",
                "sizes": "89x89"
            },
            // ...
        ]
    }
    ```
    ::: warning Advertencia
    Ver el código completo enla ruta indicada.
    :::
4. Registrar el SW (Service Worker) en **resources\views\layouts\app.blade.php**:
    ```php
    <!-- ... -->
    <head>
        <!-- ... -->
        <!-- Meta tags PWA -->
        <meta name="theme-color" content="#333333">
        <meta name="MobileOptimized" content="width">
        <meta name="HandheldFriendly" content="true">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

        <!-- Iconos PWA -->
        <link rel="shortcut icon" href="{{ asset("./Logo.png") }}" type="image/png">
        <link rel="apple-touch-icon" href="{{ asset("./Logo.png") }}" type="image/png">
        <link rel="apple-touch-startup-image" href="{{ asset("./Logo.png") }}" type="image/png">

        <!-- Manifest PWA -->
        <link rel="manifest" href="{{ asset("./manifest.json") }}">

        <title>{{ config('app.name', 'Laravel') }} | Tus antepasados te quieren libre</title>    
        <!-- ... -->
        <script src={{ asset("./register.js") }}></script>
    </head>
    <!-- ... -->
    ```
    + Aplicaar estos mismos cambios en **resources\views\welcome.blade.php**.
    ::: tip
    + **Nota**: en caso de no contar con un icono para la aplicación se puede seleccionar uno en [IconFinder](https://www.iconfinder.com). Se recomienda seleccionar un icono: **Free** y **For commercial use**.
    <p></p>
    :::
::: tip Convertir la aplicación en PWA con Vite.js
+ Siguiendo la siguiente documentación se puede convertir también nuestra aplicación en PWA con Vite.js: https://vite-pwa-org.netlify.app
+ También podemos guiarnos con este curso: https://www.udemy.com/course/react-desde-cero-pwa/learn/lecture/30230462#overview
+ En resumen:
    + npm i vite-plugin-pwa -D
    + Modificar **vite.config.ts**.
:::


## Documentación
1. Ejecutar:
    + $ npx create-vuepress-site
        + ? What's the name of your project?: App Sefar
        + ? What's the description of your project? Aplicación web para la administración de información de la empresa.
        + ? What's your email? pedro.bazo@gmail.com
        + ? What's your name? Pedro Bazó
        + ? What's the repo of your project? https://github.com/petrix12/AppSefarUniversal.git
    + $ cd docs
    + $ npm install
2. Para ejecutar la documentación:
    + $ cd docs
    + $ npm run dev     (en desarrollo)
    + $ npm run build   (construir documentación para producción)


## Crear rutas de mantenimiento de la aplicación
1. Agregar las siguientes rutas en **routes\web.php** para poder realizarle mantenimiento a la aplicación cuando se encuentre en producción:
	```php
    // RUTAS PARA EL MANTENIMIENTO DE LA APLICACIÓN EN PRODUCCIÓN
    // Ruta para ejecutar en producción: $ php artisan key:generate
    Route::get('key-generate', function(){
        Artisan::call('key:generate');
    });

    // Ruta para ejecutar en producción: $ php artisan storage:link
    Route::get('storage-link', function(){
        Artisan::call('storage:link');
    });

    // Ruta para ejecutar en producción: $ php artisan config:cache
    Route::get('config-cache', function(){
        Artisan::call('config:cache');
    });

    // Ruta para ejecutar en producción: $ php artisan cache:clear
    Route::get('cache-clear', function(){
        Artisan::call('cache:clear');
    });

    // Ruta para ejecutar en producción: $ php artisan route:clear
    Route::get('route-clear', function(){
        Artisan::call('route:clear');
    });

    // Ruta para ejecutar en producción: $ php artisan config:clear
    Route::get('config-clear', function(){
        Artisan::call('config:clear');
    });

    // Ruta para ejecutar en producción: $ php artisan view:clear
    Route::get('view-clear', function(){
        Artisan::call('view:clear');
    });
    ```
2. Commit:
	+ $ git add .
	+ $ git commit -m "Rutas para mantenimiento de la app"


## Subir proyecto local a GitHub
+ https://github.com/
1. Ejecutar:
	+ $ npm run production
	+ $ composer dumpautoload
	+ $ php artisan key:generate
2. Creamos un nuevo repositorio **público** con el nombre **AppSefarUniversal** en la página de GitHub:
	+ Las opciones de **Initialize this repository with** las dejamos sin marcar.
3. Ejecutamos en local:
	+ $ git add .
	+ $ git commit -m "Ajustes finales"
	+ $ git remote add origin https://github.com/petrix12/AppSefarUniversal.git
	+ $ git push -u origin master


## Configurar GitHub con el hosting de GoDaddy
1. Ingresar al cPanel con https://a2plcpnl0082.prod.iad2.secureserver.net:2083/
2. En la sección **ARCHIVOS** ir a **Git™ Version Control**
3. Crear repositorio ingresando los siguientes parámetros:
	+ Clone URL: https://github.com/petrix12/AppSefarUniversal.git
	+ Repository Path: public_html/app.sefaruniversal.com
	+ Repository Name: AppSefarUniversal
4. Copiar del proyecto local a la carpeta del hosting **public_html/app.sefaruniversal.com** los siguientes directorios:
	+ node_modules
	+ public/storage
	+ vendor
5. Copiar y pegar el archivo **.env** del local al hosting.
6. Cambiar las siguientes variables de entorno al archivo **.env**:
	```
    APP_NAME="App Sefar Universal"
    APP_ENV=production
    APP_KEY=base64:LsfuS5WhYfAe/FWDLdrzXFWacnFB4EgNIHBHo8ZzOSk=
    APP_DEBUG=false
    APP_URL=https://app.sefaruniversal.com

    DB_CONNECTION=mysql
    DB_HOST=127.0.0.1
    DB_PORT=3306
    DB_DATABASE=sefar
    DB_USERNAME=*****
    DB_PASSWORD=*********

    ONIDEX_CONNECTION=mysql
    ONIDEX_HOST=127.0.0.1
    ONIDEX_PORT=3306
    ONIDEX_DATABASE=onidex
    ONIDEX_USERNAME=*****
    ONIDEX_PASSWORD=*************

    MAIL_MAILER=smtp
    MAIL_HOST=sefaruniversal.com
    MAIL_PORT=587
    MAIL_USERNAME=app@sefaruniversal.com
    MAIL_PASSWORD=*********
    MAIL_ENCRYPTION=null
    MAIL_FROM_ADDRESS=app@sefaruniversal.com
    MAIL_FROM_NAME="${APP_NAME}"
    ```
7. Para configurar Laravel (AppSefar) con Gmail (info@sefarvzla.com):
	```
    MAIL_MAILER=smtp
    MAIL_HOST=smtp.gmail.com
    MAIL_PORT=465
    MAIL_USERNAME=info@sefarvzla.com
    MAIL_PASSWORD=*******
    MAIL_ENCRYPTION=ssl
    MAIL_FROM_ADDRESS=info@sefarvzla.com
    MAIL_FROM_NAME="${APP_NAME}"

    MAIL_MAILER=smtp
    MAIL_HOST=smtp.gmail.com
    MAIL_PORT=465
    MAIL_USERNAME=info@sefarvzla.com
    MAIL_PASSWORD=************
    MAIL_ENCRYPTION=ssl
    MAIL_FROM_ADDRESS=info@sefarvzla.com
    MAIL_FROM_NAME="${APP_NAME}"
    ```
	+ Luego direccionar
	    + https://app.sefaruniversal.com/config-clear
8. Direccionar las siguientes rutas:
	+ https://app.sefaruniversal.com/storage-link
	+ Esta acción simula la instrucción artisan **$ php artisan storage:link** para crear un enlace simbólico de public a storage. Verifique que no exista carpeta o acceso directo en **public** con el nombre **storage**, de ser así, elimínelo.
	+ https://app.sefaruniversal.com/config-cache
	+ Esta acción simula la instrucción artisan **php artisan config:cache** para borrar la caché de la configuración anterior.
	+ **Nota**: De aquí en adelante, cada vez que se realicen cambios en local se deberán seguir los siguientes pasos para que se reflejen en producción:
	+ En local ejecutar:
		+ $ git add .
		+ $ git commit -m "Descripción de los cambios"
		+ $ git push -u origin master
	+ En el cPanel:
		- Ingresar al cPanel con https://a2plcpnl0082.prod.iad2.secureserver.net:2083/
		- En la sección **ARCHIVOS** ir a **Git™ Version Control**.
		- Administrar el repositorio **AppSefarUniversal**.
		- Ir a la pestaña **Pull or Deploy**.
		- Presionar el botón **Update from Remote**.


## Rutas **INICIALES**
    ```
	Method      URI                               	Name
	======		===								  	====
	GET|HEAD	| / 								| inicio
	GET|HEAD	| api/user 							|
	GET|HEAD	| dashboard                        	| dashboard  
	GET|HEAD 	| forgot-password                  	| password.request   
	POST     	| forgot-password                  	| password.email   
	GET|HEAD 	| livewire/livewire.js             	|                           
	GET|HEAD 	| livewire/livewire.js.map         	|    
	POST     	| livewire/message/{name}          	| livewire.message         
	GET|HEAD 	| livewire/preview-file/{filename} 	| livewire.preview-file    
	POST     	| livewire/upload-file             	| livewire.upload-file        
	POST     	| login                            	|                                 
	GET|HEAD 	| login                            	| login                       
	POST     	| logout                           	| logout                      
	GET|HEAD 	| register                         	| register                   
	POST     	| register                         	|                               
	POST     	| reset-password                   	| password.update             
	GET|HEAD 	| reset-password/{token}           	| password.reset                 
	GET|HEAD 	| sanctum/csrf-cookie              	|                                
	POST     	| two-factor-challenge             	|                           
	GET|HEAD 	| two-factor-challenge             	| two-factor.login            
	GET|HEAD 	| user/confirm-password            	| password.confirm            
	POST     	| user/confirm-password            	|                                 
	GET|HEAD 	| user/confirmed-password-status   	| password.confirmation           
	PUT      	| user/password                    	| user-password.update            
	GET|HEAD 	| user/profile                     	| profile.show                    
	PUT      	| user/profile-information         	| user-profile-information.update
	DELETE   	| user/two-factor-authentication   	|                                 
	POST     	| user/two-factor-authentication   	|                                 
	GET|HEAD 	| user/two-factor-qr-code          	|                                
	POST     	| user/two-factor-recovery-codes   	|                                 
	GET|HEAD 	| user/two-factor-recovery-codes   	|  
    ```


## Rutas **PERMISOS**
    ```
	Method      URI                               	Name
	======		===								  	====
	GET|HEAD 	| permissions                      	| crud.permissions.index 
	POST     	| permissions                      	| crud.permissions.store
	GET|HEAD  	| permissions/create               	| crud.permissions.create 
	GET|HEAD  	| permissions/{permission}         	| crud.permissions.show
	PUT|PATCH 	| permissions/{permission}         	| crud.permissions.update
	DELETE    	| permissions/{permission}         	| crud.permissions.destroy 
	GET|HEAD  	| permissions/{permission}/edit    	| crud.permissions.edit
    ```


## Rutas **ROLES**
    ```
	Method      URI                               	Name
	======		===								  	====
	GET|HEAD 	| roles                      		| crud.roles.index 
	POST     	| roles                      		| crud.roles.store
	GET|HEAD  	| roles/create               		| crud.roles.create 
	GET|HEAD  	| roles/{role}         				| crud.roles.show
	PUT|PATCH 	| roles/{role}         				| crud.roles.update
	DELETE    	| roles/{role}         				| crud.roles.destroy 
	GET|HEAD  	| roles/{role}/edit    				| crud.roles.edit
	```


## Rutas **USUARIOS**
    ```
	Method      URI                               	Name
	======		===								  	====
	GET|HEAD 	| users                      		| crud.users.index 
	POST     	| users                      		| crud.users.store
	GET|HEAD  	| users/create               		| crud.users.create 
	GET|HEAD  	| users/{user}         				| crud.users.show
	PUT|PATCH 	| users/{user}         				| crud.users.update
	DELETE    	| users/{user}         				| crud.users.destroy 
	GET|HEAD  	| users/{user}/edit    				| crud.users.edit
    ```


## Rutas **ONIDEX**
    ```
	Method      URI                               	Name
	======		===								  	====
	GET|HEAD  	| consultaodx                      	| consultas.onidex.index
    ```


## Notas de interes
### Regresar a un commit anterior
1. Ver historia de commit:
    ```
	$ git log --pretty=oneline
    ```
2. Seleccionar el commit al cual queremos regresar:
    ```
	$ git reset --hard <commit-id>
    ```

### Para limpiar el cache
1. Ejecutar:
	+ $ php artisan config:cache 
	+ $ php artisan cache:clear

### Preparando proyecto para producción
1. Limpiar el caché de la Aplicación:
   + $ php artisan cache:clear 
2. Limpiar las rutas de la Aplicación.
    + $ php artisan route:clear  
3. Limpiar las configuraciones de la Aplicación.
    + $ php artisan config:clear 
4. Limpiar las vistas de la Aplicación.
    + $ php artisan view:clear

### Crear helper personalizado
1. Crear helper **app\helper\sefar.php**:
    ```php
    <?php
    // Obtener persona

    use App\Models\Agcliente;
    use App\Models\File;
    use App\Models\User;

    function GetPersona($IDPersona){
        $Persona = null;
        switch ($IDPersona) {
            case 1: $Persona = 'Cliente'; break;
            case 2:	$Persona = 'Padre';	break;
            case 3:	$Persona = 'Madre';	break;
            case 4:	$Persona = 'Abuelo Paterno'; break;
            case 5:	$Persona = 'Abuela Paterna'; break;
            case 6:	$Persona = 'Abuelo Materno'; break;
            case 7:	$Persona = 'Abuela Materna'; break;
            case 8: $Persona = 'Bisabuelo Pat. Pat.'; break;
            case 9: $Persona = 'Bisabuela Pat. Pat.'; break;
            case 10: $Persona = 'Bisabuelo Pat. Mat.'; break;
            case 11: $Persona = 'Bisabuela Pat. Mat.'; break;
            case 12: $Persona = 'Bisabuelo Mat. Pat.'; break;
            case 13: $Persona = 'Bisabuela Mat. Pat.'; break;
            case 14: $Persona = 'Bisabuelo Mat. Mat.'; break;
            case 15: $Persona = 'Bisabuela Mat. Mat.'; break;
            case 16: $Persona = 'Tatarabuelo PPP'; break;
            case 17: $Persona = 'Tatarabuela PPP'; break;
            case 18: $Persona = 'Tatarabuelo PPM'; break;
            case 19: $Persona = 'Tatarabuela PPM'; break;
            case 20: $Persona = 'Tatarabuelo PMP'; break;
            case 21: $Persona = 'Tatarabuela PMP'; break;
            case 22: $Persona = 'Tatarabuelo PMM'; break;
            case 23: $Persona = 'Tatarabuela PMM'; break;
            case 24: $Persona = 'Tatarabuelo MPP'; break;
            case 25: $Persona = 'Tatarabuela MPP'; break;
            case 26: $Persona = 'Tatarabuelo MPM'; break;
            case 27: $Persona = 'Tatarabuela MPM'; break;
            case 28: $Persona = 'Tatarabuelo MMP'; break;
            case 29: $Persona = 'Tatarabuela MMP'; break;
            case 30: $Persona = 'Tatarabuelo MMM'; break;
            case 31: $Persona = 'Tatarabuela MMM'; break;
        }
        return $Persona;
    }

    // Obtener persona
    function GetPersonaInv($IDPersona)
    {
        $Persona = '';
        switch ($IDPersona) {
            case 'Cliente': $Persona = 1; break;
            case 'Padre': $Persona = 2; break;
            case 'Madre': $Persona = 3; break;
            case 'Abuelo Paterno': $Persona = 4; break;
            case 'Abuela Paterna': $Persona = 5; break;
            case 'Abuelo Materno': $Persona = 6; break;
            case 'Abuela Materna': $Persona = 7; break;
            case 'Bisabuelo Pat. Pat.': $Persona = 8; break;
            case 'Bisabuela Pat. Pat.': $Persona = 9; break;
            case 'Bisabuelo Pat. Mat.': $Persona = 10; break;
            case 'Bisabuela Pat. Mat.': $Persona = 11; break;
            case 'Bisabuelo Mat. Pat.': $Persona = 12; break;
            case 'Bisabuela Mat. Pat.': $Persona = 13; break;
            case 'Bisabuelo Mat. Mat.': $Persona = 14; break;
            case 'Bisabuela Mat. Mat.': $Persona = 15; break;
            case 'Tatarabuelo PPP': $Persona = 16; break;
            case 'Tatarabuela PPP': $Persona = 17; break;
            case 'Tatarabuelo PPM': $Persona = 18; break;
            case 'Tatarabuela PPM': $Persona = 19; break;
            case 'Tatarabuelo PMP': $Persona = 20; break;
            case 'Tatarabuela PMP': $Persona = 21; break;
            case 'Tatarabuelo PMM': $Persona = 22; break;
            case 'Tatarabuela PMM': $Persona = 23; break;
            case 'Tatarabuelo MPP': $Persona = 24; break;
            case 'Tatarabuela MPP': $Persona = 25; break;
            case 'Tatarabuelo MPM': $Persona = 26; break;
            case 'Tatarabuela MPM': $Persona = 27; break;
            case 'Tatarabuelo MMP': $Persona = 28; break;
            case 'Tatarabuela MMP': $Persona = 29; break;
            case 'Tatarabuelo MMM': $Persona = 30; break;
            case 'Tatarabuela MMM': $Persona = 31; break;
        }
        return $Persona;
    }

    // Obtener generación
    function GetGeneracion($IDPersona)
    {
        $Generacion = NULL;
        switch ($IDPersona) {
            case 1: $Generacion = 1; break;
            case 2: $Generacion = 2; break;
            case 3: $Generacion = 2; break;
            case 4: $Generacion = 3; break;
            case 5: $Generacion = 3; break;
            case 6: $Generacion = 3; break;
            case 7: $Generacion = 3; break;
            case 8: $Generacion = 4; break;
            case 9: $Generacion = 4; break;
            case 10: $Generacion = 4; break;
            case 11: $Generacion = 4; break;
            case 12: $Generacion = 4; break;
            case 13: $Generacion = 4; break;
            case 14: $Generacion = 4; break;
            case 15: $Generacion = 4; break;
            case 16: $Generacion = 5; break;
            case 17: $Generacion = 5; break;
            case 18: $Generacion = 5; break;
            case 19: $Generacion = 5; break;
            case 20: $Generacion = 5; break;
            case 21: $Generacion = 5; break;
            case 22: $Generacion = 5; break;
            case 23: $Generacion = 5; break;
            case 24: $Generacion = 5; break;
            case 25: $Generacion = 5; break;
            case 26: $Generacion = 5; break;
            case 27: $Generacion = 5; break;
            case 28: $Generacion = 5; break;
            case 29: $Generacion = 5; break;
            case 30: $Generacion = 5; break;
            case 31: $Generacion = 5; break;
        }
        return $Generacion;
    }

    // Obtener IDPadre
    function GetIDPadre($IDPersona)
    {
        $IDPadre = -1;
        switch ($IDPersona) {
            case 1:$IDPadre = 2; break;
            case 2: $IDPadre = 4; break;
            case 3: $IDPadre = 6; break;
            case 4: $IDPadre = 8; break;
            case 5: $IDPadre = 10; break;
            case 6: $IDPadre = 12; break;
            case 7: $IDPadre = 14; break;
            case 8: $IDPadre = 16; break;
            case 9: $IDPadre = 18; break;
            case 10: $IDPadre = 20; break;
            case 11: $IDPadre = 22; break;
            case 12: $IDPadre = 24; break;
            case 13: $IDPadre = 26; break;
            case 14: $IDPadre = 28; break;
            case 15: $IDPadre = 30; break;
        }
        return $IDPadre;
    }

    // Obtener IDHijo
    function GetIDHijo($IDPersona)
    {
        $IDHijo = null;
        switch ($IDPersona) {
            case 1:$IDHijo = null; break;
            case 2: $IDHijo = 1; break;
            case 3: $IDHijo = 1; break;
            case 4: $IDHijo = 2; break;
            case 5: $IDHijo = 2; break;
            case 6: $IDHijo = 3; break;
            case 7: $IDHijo = 3; break;
            case 8: $IDHijo = 4; break;
            case 9: $IDHijo = 4; break;
            case 10: $IDHijo = 5; break;
            case 11: $IDHijo = 5; break;
            case 12: $IDHijo = 6; break;
            case 13: $IDHijo = 6; break;
            case 14: $IDHijo = 7; break;
            case 15: $IDHijo = 7; break;
            case 16: $IDHijo = 8; break;
            case 17: $IDHijo = 8; break;
            case 18: $IDHijo = 9; break;
            case 19: $IDHijo = 9; break;
            case 20: $IDHijo = 10; break;
            case 21: $IDHijo = 10; break;
            case 22: $IDHijo = 11; break;
            case 23: $IDHijo = 11; break;
            case 24: $IDHijo = 12; break;
            case 25: $IDHijo = 12; break;
            case 26: $IDHijo = 13; break;
            case 27: $IDHijo = 13; break;
            case 28: $IDHijo = 14; break;
            case 29: $IDHijo = 14; break;
            case 30: $IDHijo = 15; break;
            case 31: $IDHijo = 15; break;
        }
        return $IDHijo;
    }

    // Obtener id de la persona IDPersona
    function GetID($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->id;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener nombres de la persona IDPersona
    function GetNombres($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->Nombres;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener apellidos de la persona IDPersona
    function GetApellidos($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->Apellidos;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener campo Familiares de la persona IDPersona
    function GetFamiliares($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->Familiares;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener sexo de la persona IDPersona
    function GetSexo($agclientes, $IDPersona){
        try{
            if($IDPersona){
                return $agclientes->where('IDPersona',$IDPersona)->first()->Sexo;
            }else{
                return $IDPersona % 2 ? "F" : "M";
            }
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener observaciones de la persona IDPersona
    function GetObservaciones($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->Observaciones;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener año de nacimiento de la persona IDPersona
    function GetAnhoNac($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->AnhoNac;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener mes de nacimiento de la persona IDPersona
    function GetMesNac($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->MesNac;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener día de nacimiento de la persona IDPersona
    function GetDiaNac($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->DiaNac;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener lugar de nacimiento de la persona IDPersona
    function GetLugarNac($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->LugarNac;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener país de nacimiento de la persona IDPersona
    function GetPaisNac($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->PaisNac;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener año de bautizo de la persona IDPersona
    function GetAnhoBtzo($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->AnhoBtzo;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener mes de bautizo de la persona IDPersona
    function GetMesBtzo($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->MesBtzo;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener día de bautizo de la persona IDPersona
    function GetDiaBtzo($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->DiaBtzo;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener lugar de bautizo de la persona IDPersona
    function GetLugarBtzo($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->LugarBtzo;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener país de bautizo de la persona IDPersona
    function GetPaisBtzo($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->PaisBtzo;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener año de matrimonio de la persona IDPersona
    function GetAnhoMatr($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->AnhoMatr;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener mes de matrimonio de la persona IDPersona
    function GetMesMatr($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->MesMatr;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener día de matrimonio de la persona IDPersona
    function GetDiaMatr($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->DiaMatr;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener lugar de matrimonio de la persona IDPersona
    function GetLugarMatr($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->LugarMatr;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener país de matrimonio de la persona IDPersona
    function GetPaisMatr($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->PaisMatr;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener año de defunción de la persona IDPersona
    function GetAnhoDef($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->AnhoDef;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener mes de defunción de la persona IDPersona
    function GetMesDef($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->MesDef;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener día de defunción de la persona IDPersona
    function GetDiaDef($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->DiaDef;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener lugar de defunción de la persona IDPersona
    function GetLugarDef($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->LugarDef;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener país de defunción de la persona IDPersona
    function GetPaisDef($agclientes, $IDPersona){
        try{
            return $agclientes->where('IDPersona',$IDPersona)->first()->PaisDef;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener fecha de matrimonio de la persona IDPersona
    function GetFechaMatr($agclientes, $IDPersona){
        try{
            $AnhoMatr = $agclientes->where('IDPersona',$IDPersona)->first()->AnhoMatr;
            $AnhoMatr = $AnhoMatr ? $AnhoMatr : '--';
            $MesMatr = $agclientes->where('IDPersona',$IDPersona)->first()->MesMatr;
            $MesMatr = $MesMatr ? $MesMatr : '--';
            $DiaMatr = $agclientes->where('IDPersona',$IDPersona)->first()->DiaMatr;
            $DiaMatr = $DiaMatr ? $DiaMatr : '--';

            return "$DiaMatr / $MesMatr / $AnhoMatr";
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener datos de matrimonio de la persona IDPersona
    function GetDatosMatrimonio($agclientes, $IDPersona){
        $matrimonio = "Matrimonio: ";
        $lugar = GetLugarMatr($agclientes,$IDPersona);
        $matrimonio = $matrimonio . $lugar . ' ';
        $fecha = GetFechaMatr($agclientes,$IDPersona);
        $matrimonio = $matrimonio . $fecha;
        return $matrimonio;
    }

    // Obtener años de vida de la persona IDPersona
    function GetVida($agclientes, $IDPersona){
        try{
            $AnhoNac = $agclientes->where('IDPersona',$IDPersona)->first()->AnhoNac;
            $AnhoNac = $AnhoNac ? $AnhoNac : '--';
            $AnhoDef = $agclientes->where('IDPersona',$IDPersona)->first()->AnhoDef;
            $AnhoDef = $AnhoDef ? $AnhoDef : '--';
            return $AnhoNac . ' / ' . $AnhoDef;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener lugar y años de vida de la persona IDPersona
    function GetVidaCompleta($agclientes, $IDPersona){
        try{
            $AnhoNac = $agclientes->where('IDPersona',$IDPersona)->first()->AnhoNac;
            $AnhoNac = $AnhoNac ? $AnhoNac : '--';
            $MesNac = $agclientes->where('IDPersona',$IDPersona)->first()->MesNac;
            $MesNac = $MesNac ? $MesNac : '--';
            $DiaNac = $agclientes->where('IDPersona',$IDPersona)->first()->DiaNac;
            $DiaNac = $DiaNac ? $DiaNac : '--';
            $LugarNac = $agclientes->where('IDPersona',$IDPersona)->first()->LugarNac;
            $Nacimiento ="Nacimiento: $LugarNac, $DiaNac / $MesNac / $AnhoNac";

            $AnhoDef = $agclientes->where('IDPersona',$IDPersona)->first()->AnhoDef;
            $AnhoDef = $AnhoDef ? $AnhoDef : '--';
            $MesDef = $agclientes->where('IDPersona',$IDPersona)->first()->MesDef;
            $MesDef = $MesDef ? $MesDef : '--';
            $DiaDef = $agclientes->where('IDPersona',$IDPersona)->first()->DiaDef;
            $DiaDef = $DiaDef ? $DiaDef : '--';
            $LugarDef = $agclientes->where('IDPersona',$IDPersona)->first()->LugarDef;
            $Defuncion ="Defunción: $LugarDef, $DiaDef / $MesDef / $AnhoDef";

            return "$Nacimiento - $Defuncion";
        }catch(Exception $e){
            return null;
        }
    }

    function AddPersona($IDCliente, $IDPersona){
        $Sexo = $IDPersona % 2 ? 'F' : 'M';
        $agcliente = Agcliente::create([
            'IDCliente' => $IDCliente,
            'IDPersona' => $IDPersona,
            'Sexo' => $Sexo,
            'IDPadre' => GetIDPadre($IDPersona),
            'IDMadre' => GetIDPadre($IDPersona) + 1,
            'Generacion' => GetGeneracion($IDPersona),
            'FUpdate' => date('Y-m-d H:i:s'),
            'Usuario' => Auth()->user()->email,
        ]);
        return $agcliente;
    }

    // Contenido de la caja de persona para la cajas de la vista Olivo
    function GetBoxPerson($agclientes, $IDPersona): string{
        $contenido = '
            <p class="text-xs underline" title="'.GetDatosMatrimonio($agclientes,$IDPersona).'">'.GetPersona($IDPersona).'</p>
            <p class="text-xs font-bold">'.GetNombres($agclientes, $IDPersona).'</p>
            <p class="text-xs font-bold">'.GetApellidos($agclientes, $IDPersona).'</p>
        ';
        //return $contenido;
        return GetPersona($IDPersona);
    }

    // Verifica si una persona existe
    function existePer($agclientes, $IDPersona){
        try {
            return $agclientes->where('IDPersona',$IDPersona)->first()->IDCliente;
        } catch (\Throwable $e) {
            return null;
        }
    }

    // Comprobar que una persona tiene documentos
    function existeDoc($pasaporte, $IDPersona){
        try{
            return File::where('IDCliente',$pasaporte)->where('IDPersona', $IDPersona)->first()->id;
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener documentos de una persona
    function getDocumentos($pasaporte, $IDPersona){
        try{
            return File::where('IDCliente',$pasaporte)->where('IDPersona', $IDPersona)->get();
        }catch(Exception $e){
            return null;
        }
    }

    // Obtener servicio
    function getServicio($passport){
        try{
            return User::where('passport',$passport)->first()->servicio;
        }catch(Exception $e){
            return null;
        }
    }
    ```
2. Modificar **composer.json** para agregar el helper **app\helper\sefar.php**
	```php
    ≡
    "autoload": {
        "psr-4": {
            "App\\": "app/",
            "Database\\Factories\\": "database/factories/",
            "Database\\Seeders\\": "database/seeders/"
        },	
        "files": [
            "app/helper/sefar.php"
        ]
    },
    ≡
    ```
3. Ejecutar:
	+ $ composer dump-autoload
4. Configurar **config\adminlte.php** para crear un menú para pruebas:
    + Ver código en el repositorio
5. Crear archivo de estilo **public\css\prueba_flex.css**:
    + Ver código en el repositorio
6. Si no se reflejan los cambios ejecutar:
	+$ php artisan config:cache

### Configuración de conexión a MySQL Hosting
1. Configuración de **.env**:
	```
    ≡
    DB_CONNECTION=mysql
    DB_HOST=107.180.2.195
    DB_PORT=3306
    DB_DATABASE=sefar
    DB_USERNAME=pxvim6av41qx
    DB_PASSWORD=*****
	```
	+ IP pública:
    	+ https://www.cual-es-mi-ip.net

### Colores Sefar:
+ Rojo: R:121 G:22 B:15
+ Verde: R:22 G:43 B:27
+ Amarillo: R:247 G:176 B:52
+ Gris: R:63 G:61 B:61

### Tablas a reponer al restaurar base de datos:
+ agclientes
+ books
+ families
+ libraries

### Para publicar y personalizar páginas de errores http. 
+ $ php artisan vendor:publish --tag=laravel-errors
+ **Nota**: las vistas para manejar los errores se ubicaran en **resources\views\errors**.

### Incluir destinatarios en las notificaciones:
1. Archivos a modificar para incluir destinatarios en las notificaciones:
	+ Registro: app\Actions\Fortify\CreateNewUser.php
	+ Actualización: app\Http\Controllers\ClienteController.php

### Crear modelo:
1. Diferentes formas para crear modelos:
	+ Crear solo el modelo
		- $ php artisan make:model Model
	+ Crear el modelo con migración:
		- $ php artisan make:model Model -m
	+ Crear el modelo con migración y controlador:
		- $ php artisan make:model Model -mc
	+ Crear el modelo con migración, controlador y seeder:
		- $ php artisan make:model Model -mcs
	+ Crear el modelo con migración, controlador, seeder y factory:
		- $ php artisan make:model Model -mcsf
	+ Crear el modelo con migración con todo:
		- $ php artisan make:model Model -a

### Clonar el repositorio AppSefarUniversal desde GitHub
1. Clonar repositorio en local:
	+ $ git clone https://github.com/petrix12/AppSefarUniversal.git
	**Nota 1**: En mi caso el repositorio lo clonaré en **C:\xampp\htdocs** y luego cambiaré el nombre de **AppSefarUniversal** a **sefar**.
	**Nota 2**: Para este ejercicio se está utilizando **XAMPP** como entorno de desarrollo, en caso de utilizar otro entorno como **Laragon** o **WAMPServer** realizar las modificaciones correspondiente a cada caso.
2. Ejecutar una terminal en el proyecto recién creado y ejecutar los siguientes comandos desde esa ruta.
3. Instalar dependencias de **PHP** y **NPM**:
	+ $ composer install
	+ $ npm install
	**Nota**: en caso de presentarse vulnerabilidades ejecutar (**Revisar esta solución más a fonndo**):
	+ $ npm install -g npm@latest		(para actualizar NPM)
	+ $ npm cache clean --force			(borrar la cache de NPM)
	+ $ npm set audit false				(desactivar las auditorias de NPM)
4. En caso de no tener creada las bases de datos **sefar** y **onidex** en MySQL, entonces proceder a crearlas (juego de caracteres a utilizar para ambas: **utf8_general_ci**) y seguir los siguientes pasos:
	+ $ php artisan migrate:fresh --seed
	+ Importar a la base de datos **sefar** en local la estructura de la tabla **agclientes** desde la base de datos **sefar** del servidor de producción ya que esta tabla no se creará. En caso de querer traerte el proyecto completo entonces exportarla con sus datos.
	+ Importar a la base de datos **onidex** en local la estructura de la tabla **agclientes** desde la base de datos **sefar** del servidor de producción ya que esta tabla no se creará. En caso de querer traerte el proyecto completo entonces exportarla con sus datos.
5. Copiar la siguiente ruta de acceso relativa del servidor de producción al local:
	+ storage\app\public
	**Nota**: en caso de pretender instalar el proyecto vacio, entonces traerse solo la estructura de directorios.
6. En caso de no tener un host virtual creado para nuestro proyecto, seguir los siguientes pasos:
	1. Ejecutar el bloc de notas como administrador.
    2. Abrir el archivo: **C:\Windows\System32\drivers\etc\hosts**.
    3. En la parte final del archivo escribir:
		```
		127.0.0.1     sefar.test
		```
    4. Guardar y cerrar.
    5. Editar con el bloc de notas el archivo: **C:\xampp\apache\conf\extra\httpd-vhosts.conf**.
    6. Ir al final del archivo y anexar lo siguiente:
        + Si nunca has creado un virtual host agregar:
			```conf
			<VirtualHost *>
				DocumentRoot "C:\xampp\htdocs"
				ServerName localhost
			</VirtualHost>
			```
			**Nota**: Esta estructura se agregará una única vez.
        + Luego agregar:
			```conf
			<VirtualHost *>
			DocumentRoot "C:\xampp\htdocs\sefar\public"
			ServerName sefar.test
			<Directory "C:\xampp\htdocs\sefar\public">
				Options All
				AllowOverride All
				Require all granted
			</Directory>
			</VirtualHost>
        	```
    7. Guardar y cerrar.
    8. Apagar y encender el servidor Apache.
    **Nota 1**: ahora podemos ejecutar nuestro proyecto en el navegador introduciendo la siguiente dirección: http://sefar.test
    **Nota 2**: En caso de que no funcione el enlace, cambiar en el archivo **C:\xampp\apache\conf\extra\httpd-vhosts.conf** el segmento de código **<VirtualHost \*>** por **<VirtualHost *:80>**.
7. Crear el archivo de variables de entorno **.env** en la raíz del proyecto:
	```
	APP_NAME="App Sefar Universal"
	APP_ENV=local
	APP_KEY=
	APP_DEBUG=true
	APP_URL=http://sefar.test

	LOG_CHANNEL=stack
	LOG_LEVEL=debug

	DB_CONNECTION=mysql
	DB_HOST=127.0.0.1
	DB_PORT=3306
	DB_DATABASE=sefar
	DB_USERNAME=root
	DB_PASSWORD=

	ONIDEX_CONNECTION=mysql
	ONIDEX_HOST=127.0.0.1
	ONIDEX_PORT=3306
	ONIDEX_DATABASE=onidex
	ONIDEX_USERNAME=root
	ONIDEX_PASSWORD=

	BROADCAST_DRIVER=log
	CACHE_DRIVER=file
	QUEUE_CONNECTION=sync
	SESSION_DRIVER=database
	SESSION_LIFETIME=120

	MEMCACHED_HOST=127.0.0.1

	REDIS_HOST=127.0.0.1
	REDIS_PASSWORD=null
	REDIS_PORT=6379

	MAIL_MAILER=smtp
	MAIL_HOST=smtp.mailtrap.io
	MAIL_PORT=2525
	MAIL_USERNAME=7c67f786972696
	MAIL_PASSWORD=8f37b2d25228ba
	MAIL_ENCRYPTION=tls
	MAIL_FROM_ADDRESS=app.web@sefarvzla.com
	MAIL_FROM_NAME="${APP_NAME}"

	AWS_ACCESS_KEY_ID=
	AWS_SECRET_ACCESS_KEY=
	AWS_DEFAULT_REGION=us-east-1
	AWS_BUCKET=

	PUSHER_APP_ID=
	PUSHER_APP_KEY=
	PUSHER_APP_SECRET=
	PUSHER_APP_CLUSTER=mt1

	MIX_PUSHER_APP_KEY="${PUSHER_APP_KEY}"
	MIX_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"

	VAR_TMP='inicial'
	```
7. Generar clave para la variable de entorno **APP_KEY**:
	+ $ php artisan key:generate
8. Generar acceso directo (enlace simbólico) de public a storage:
	+ $ php artisan storage:link

